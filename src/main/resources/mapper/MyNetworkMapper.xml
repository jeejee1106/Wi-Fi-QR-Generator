<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.project.mypage.mapper.MyNetworkMapper">

    <!-- 내 네트워크 목록 조회 -->
    <select id="getMyNetworkList" resultType="com.example.project.mypage.dto.response.MyNetworkRes">
        /* MyNetworkMapper.getMyNetworkList */
        SELECT
              network_seq
            , ssid
            , alias
            , active_yn
            , created_at
        FROM
            wifi_network
        WHERE
            user_seq = #{userSeq}
            <if test="cond.activeYn != null and cond.activeYn != ''">
                AND active_yn = #{cond.activeYn}
            </if>
            <if test="cond.ssidKeyword != null and cond.ssidKeyword != ''">
                AND ssid LIKE CONCAT('%', #{cond.ssidKeyword}, '%')
            </if>
        ORDER BY created_at DESC
    </select>

    <!-- 내 네트워크 단건 조회 -->
    <select id="getMyNetwork" resultType="com.example.project.mypage.dto.response.MyNetworkDetailRes">
        /* MyNetworkMapper.getMyNetwork */
        SELECT
              network_seq
            , ssid
            , auth_type
            , hidden_yn
            , alias
            , memo
            , active_yn
            , guest_yn
            , created_at
            , updated_at
        FROM
            wifi_network
        WHERE 1=1
            AND network_seq = #{networkSeq}
            AND user_seq = #{userSeq}   <!-- 소유자 검증까지 한 번에 -->
    </select>

    <!-- 내 네트워크 수정 -->
    <update id="updateMyNetwork">
        /* MyNetworkMapper.updateMyNetwork */
        UPDATE
            wifi_network
        <set>
            <if test="req.ssid != null and req.ssid != ''">
            , ssid = #{req.ssid}
            </if>
            <if test="req.password != null and req.password != ''">
            , password = #{req.password}
            </if>
            <if test="req.authType != null and req.authType != ''">
            , auth_type = #{req.authType}
            </if>
            <if test="req.hiddenYn != null and req.hiddenYn != ''">
            , hidden_yn = #{req.hiddenYn}
            </if>
            <if test="req.alias != null and req.alias != ''">
            , alias = #{req.alias}
            </if>
            <if test="req.memo != null and req.memo != ''">
            , memo = #{req.memo}
            </if>
            <if test="req.activeYn != null and req.activeYn != ''">
            , active_yn = #{req.activeYn}
            </if>
        </set>
        WHERE 1=1
            AND network_seq = #{networkSeq}
            AND user_seq = #{userSeq}   <!-- 소유자 검증까지 한 번에 -->
    </update>
</mapper>